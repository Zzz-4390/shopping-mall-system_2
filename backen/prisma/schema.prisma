generator client {
  provider = "prisma-client-js"
  log      = ["query"] // 打印执行的 SQL
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model cart {
  cartid     String     @id @db.Char(36)
  cartuserid String     @db.Char(36)
  users      users      @relation(fields: [cartuserid], references: [userid], onUpdate: NoAction, map: "cart_ibfk_1")
  cartitem   cartitem[]

  @@index([cartuserid], map: "cartuserid")
}

model cartitem {
  cartitemid String   @id @db.Char(36)
  cartid     String   @db.Char(36)
  productid  String   @db.Char(36)
  entertime  DateTime @default(now()) @db.DateTime(0)
  product    product  @relation(fields: [productid], references: [productid], onUpdate: NoAction, map: "cartitem_ibfk_1")
  cart       cart     @relation(fields: [cartid], references: [cartid], onUpdate: NoAction, map: "cartitem_ibfk_2")

  @@unique([cartid, productid], map: "cart_product_unique") // 同一购物车不能重复添加同一商品
  @@index([cartid], map: "cartid")
  @@index([productid], map: "productid")
}

model message {
  messageid                       String   @id @db.Char(36)
  senderid                        String   @db.Char(36)
  receiverid                      String   @db.Char(36)
  type                            String   @db.Char(6)
  content                         String   @db.VarChar(1000)
  title                           String   @db.VarChar(50)
  isread                          Boolean  @default(false)
  sendtime                        DateTime @default(now()) @db.DateTime(0)
  conversationid                  String   @db.Char(36)
  users_message_senderidTousers   users    @relation("message_senderidTousers", fields: [senderid], references: [userid], onDelete: NoAction, onUpdate: NoAction, map: "message_ibfk_1")
  users_message_receiveridTousers users    @relation("message_receiveridTousers", fields: [receiverid], references: [userid], onDelete: NoAction, onUpdate: NoAction, map: "message_ibfk_2")

  @@index([receiverid], map: "receiverid")
  @@index([senderid], map: "senderid")
  @@index([conversationid, sendtime], map: "idx_conversation_sendtime") // 按会话查询消息记录
}

model orders {
  orderid                      String    @id @db.Char(36)
  buyerid                      String    @db.Char(36)
  sellerid                     String    @db.Char(36)
  productid                    String    @db.Char(36)
  createtime                   DateTime? @default(now()) @db.DateTime(0)
  finishtime                   DateTime? @db.DateTime(0)
  isdone                       Boolean?  @default(false)
  users_orders_buyeridTousers  users     @relation("orders_buyeridTousers", fields: [buyerid], references: [userid], onDelete: NoAction, onUpdate: NoAction, map: "orders_ibfk_1")
  users_orders_selleridTousers users     @relation("orders_selleridTousers", fields: [sellerid], references: [userid], onDelete: NoAction, onUpdate: NoAction, map: "orders_ibfk_2")
  product                      product   @relation(fields: [productid], references: [productid], onDelete: NoAction, onUpdate: NoAction, map: "orders_ibfk_3")

  @@index([buyerid], map: "buyerid")
  @@index([productid], map: "productid")
  @@index([sellerid], map: "sellerid")
}

model product {
  productid   String     @id @db.Char(36)
  sellerid    String     @db.Char(36)
  title       String     @db.VarChar(50)
  content     String     @db.VarChar(1000)
  price       Int
  photo       String?    @db.VarChar(500)
  status      String     @db.Char(20)
  publishtime DateTime   @default(now()) @db.DateTime(0)
  category    String     @db.Char(20)
  cartitem    cartitem[]
  orders      orders[]
  users       users      @relation(fields: [sellerid], references: [userid], onUpdate: NoAction, map: "product_ibfk_1")

  @@index([sellerid], map: "sellerid")
  @@index([status, category, publishtime], map: "idx_product_listing") // 商品列表筛选索引
}

model users {
  userid                            String    @id @db.Char(36)
  phone                             String    @unique(map: "phone") @db.Char(11)
  password                          String    @db.VarChar(20)
  name                              String    @db.VarChar(20)
  photo                             Bytes?    @db.MediumBlob
  registertime                      DateTime  @default(now()) @db.DateTime(0)
  cart                              cart[]
  message_message_senderidTousers   message[] @relation("message_senderidTousers")
  message_message_receiveridTousers message[] @relation("message_receiveridTousers")
  orders_orders_buyeridTousers      orders[]  @relation("orders_buyeridTousers")
  orders_orders_selleridTousers     orders[]  @relation("orders_selleridTousers")
  product                           product[]
}
